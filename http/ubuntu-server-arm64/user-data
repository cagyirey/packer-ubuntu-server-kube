#cloud-config
autoinstall:
  version: 1

  packages:
    # desktop
    - kde-plasma-desktop
    - kde-workspace
    - network-manager-openvpn

    # recon
    - nmap
    - 

  apt:
    preserve_sources_list: true
    sources:
      docker:
        source: deb [arch=arm64] https://download.docker.com/linux/ubuntu $RELEASE stable
        keyid: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88

  refresh-installer:
    update: yes

  storage:
    layout:
      name: lvm

  early-commands:
    - systemctl stop ssh # otherwise packer tries to connect and exceed max attempts

  codecs:
    install: yes

  keyboard:
    layout: us

  # identity:
  #   hostname: localhost
  #   username: vagrant
  #   password: "$6$bhZARn1NjBXaQ.M.$JqHfRKB96fwRQQWNGH.tBxyECYY9rrbBeS8br84ccn4OSnC.7pyhvHunpobZ8fV8NCOIXasRGyZT4MCJWQYtM1"

  ssh:
    install-server: yes
    allow-pw: no
    #authorized-keys:

  user-data: 

    users:
      - name: ubuntu
        groups: users
        passwd: "$6$bhZARn1NjBXaQ.M.$JqHfRKB96fwRQQWNGH.tBxyECYY9rrbBeS8br84ccn4OSnC.7pyhvHunpobZ8fV8NCOIXasRGyZT4MCJWQYtM1" # ubuntu
        sudo: ALL=(ALL) NOPASSWD:ALL
        lock_passwd: false
        shell: /bin/bash
        ssh_import_id:
          - gh:cagyirey